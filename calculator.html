<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Calculator | Manthong Group</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: url('https://images.unsplash.com/photo-1554224155-6726b3ff858f?auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
            background-size: cover;
        }
        .calc-container { max-width: 900px; margin-top: 80px; }
        .result-box {
            background: var(--primary-color, #1a237e);
            color: white;
            border-radius: 0 15px 15px 0;
            padding: 40px;
        }
        @media (max-width: 768px) {
            .result-box { border-radius: 0 0 15px 15px; }
        }
        .monthly-installment { font-size: 3rem; font-weight: 800; color: #fbc02d; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">ðŸš— MANTHONG GROUP</a>
            <div class="ms-auto">
                <a href="index.html" class="btn btn-outline-light btn-sm me-2">Home</a>
                <a href="login.html" class="btn btn-warning btn-sm fw-bold">System Management</a>
            </div>
        </div>
    </nav>

    <div class="container calc-container">
        <div class="glass-card p-0 overflow-hidden">
            <div class="row g-0">
                <div class="col-md-7 p-4 p-lg-5 bg-white">
                    <h2 class="fw-bold mb-4 text-dark">Loan Calculator</h2>
                    <form id="loan-form">
                        <div class="mb-4">
                            <label class="form-label fw-bold text-muted small">CAR PRICE (RM)</label>
                            <input type="number" id="car-price" class="form-control form-control-lg border-primary" placeholder="e.g. 85000" oninput="syncDP('range')">
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold text-muted small">DOWN PAYMENT</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text bg-light">RM</span>
                                <input type="number" id="dp-cash" class="form-control form-control-lg" placeholder="Enter Amount" oninput="syncDP('cash')">
                            </div>
                            <div class="d-flex align-items-center gap-3">
                                <input type="range" class="form-range" id="dp-range" min="0" max="50" step="5" value="10" oninput="syncDP('range')">
                                <span id="dp-label" class="badge bg-primary p-2">10%</span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-bold text-muted small">PERIOD (YEARS)</label>
                                <select id="loan-years" class="form-select form-select-lg" onchange="updateCalculation()">
                                    <option value="3">3 Years</option>
                                    <option value="4">4 Years</option>
                                    <option value="5">5 Years</option>
                                    <option value="6">6 Years</option>
                                    <option value="7">7 Years</option>
                                    <option value="8">8 Years</option>
                                    <option value="9" selected>9 Years</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-bold text-muted small">INTEREST RATE (%)</label>
                                <input type="number" id="interest-rate" class="form-control form-control-lg" value="3.8" step="0.1" oninput="updateCalculation()">
                            </div>
                        </div>
                    </form>
                </div>

                <div class="col-md-5 result-box d-flex flex-column justify-content-center text-center text-white">
                    <h5 class="text-white-50 text-uppercase tracking-widest small">Estimated Monthly</h5>
                    <div class="monthly-installment" id="monthly-payment">RM 0.00</div>
                    <hr class="my-4 opacity-25">
                    <div class="text-start px-3 mb-4">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-white-50">Down Payment:</span>
                            <span id="res-dp" class="fw-bold text-white">RM 0</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-white-50">Total Loan:</span>
                            <span id="res-loan" class="fw-bold text-white">RM 0</span>
                        </div>
                    </div>
                    <button class="btn btn-warning btn-lg fw-bold shadow-sm" onclick="copyQuote()">
                        <i class="bi bi-whatsapp"></i> Copy Quote
                    </button>
                    <p class="small text-white-50 mt-3">*Calculation for reference only</p>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // è‡ªåŠ¨ä»Ž URL èŽ·å–ä»·æ ¼
            const params = new URLSearchParams(window.location.search);
            if (params.has('price')) {
                document.getElementById('car-price').value = params.get('price');
                syncDP('range'); // åˆå§‹åŒ–è®¡ç®—
            }
            updateCalculation();
        });

        // åŒæ­¥å¤´æœŸé‡‘é¢ä¸Žç™¾åˆ†æ¯”
        function syncDP(type) {
            const price = parseFloat(document.getElementById('car-price').value) || 0;
            const dpCashInput = document.getElementById('dp-cash');
            const dpRangeInput = document.getElementById('dp-range');
            const dpLabel = document.getElementById('dp-label');

            if (type === 'range') {
                const percent = dpRangeInput.value;
                dpCashInput.value = price > 0 ? (price * (percent / 100)).toFixed(0) : "";
                dpLabel.innerText = percent + "%";
            } else if (type === 'cash') {
                if (price > 0) {
                    const cash = dpCashInput.value || 0;
                    const percent = Math.round((cash / price) * 100);
                    dpRangeInput.value = percent > 50 ? 50 : percent; // æœ€é«˜é™é¢æ˜¾ç¤º
                    dpLabel.innerText = (percent > 100 ? 100 : percent) + "%";
                }
            }
            updateCalculation();
        }

        // æ ¸å¿ƒè®¡ç®—é€»è¾‘
        function updateCalculation() {
            const price = parseFloat(document.getElementById('car-price').value) || 0;
            const dpAmount = parseFloat(document.getElementById('dp-cash').value) || 0;
            const years = parseInt(document.getElementById('loan-years').value);
            const interest = parseFloat(document.getElementById('interest-rate').value) / 100;

            const loanAmount = price - dpAmount;
            
            // é©¬æ¥è¥¿äºšè½¦è´·ç®—æ³• (Fixed Rate)
            const totalInterest = loanAmount * interest * years;
            const monthly = loanAmount > 0 ? (loanAmount + totalInterest) / (years * 12) : 0;

            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('res-dp').innerText = 'RM ' + dpAmount.toLocaleString();
            document.getElementById('res-loan').innerText = 'RM ' + (loanAmount > 0 ? loanAmount.toLocaleString() : 0);
            document.getElementById('monthly-payment').innerText = monthly > 0 ? 'RM ' + monthly.toFixed(2) : 'RM 0.00';
        }

        // WhatsApp æŠ¥ä»·å¤åˆ¶
        function copyQuote() {
            const price = document.getElementById('car-price').value || "0";
            const monthly = document.getElementById('monthly-payment').innerText;
            const years = document.getElementById('loan-years').value;
            const dp = document.getElementById('dp-cash').value || "0";
            
            const text = `ðŸš— *Car Quotation - Manthong Group* \n\n` +
                         `Car Price: RM ${parseFloat(price).toLocaleString()}\n` +
                         `Down Payment: RM ${parseFloat(dp).toLocaleString()}\n` +
                         `Loan Period: ${years} Years\n` +
                         `*Monthly Installment: ${monthly}*\n\n` +
                         `Contact us for full details!`;
            
            navigator.clipboard.writeText(text).then(() => {
                alert('Success! Quote copied for WhatsApp.');
            });
        }
    </script>
</body>
</html>