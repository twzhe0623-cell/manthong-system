<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Stock | Manthong Group</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">

    <nav class="navbar navbar-dark bg-dark mb-4 shadow-sm">
        <div class="container-fluid px-4">
            <a class="navbar-brand fw-bold" href="admin.html"><i class="bi bi-cpu"></i> INVENTORY CONTROL</a>
            <div class="d-flex gap-2">
                <button class="btn btn-danger btn-sm" onclick="openRecycleBin()"><i class="bi bi-trash"></i> Recycle Bin</button>
                <a href="admin.html" class="btn btn-outline-light btn-sm">Exit</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid px-4">
        <div class="row">
            <div class="col-lg-4">
                <div class="glass-card p-4 sticky-top shadow border-0" style="top: 80px;">
                    <h4 id="form-title" class="fw-bold mb-4 text-primary">Add New Vehicle</h4>
                    <form id="car-form">
                        <input type="hidden" id="edit-index" value="-1">
                        
                        <div class="row mb-3">
                            <div class="col-6"><label class="form-label small fw-bold">Brand</label><input type="text" id="car-brand" class="form-control" required></div>
                            <div class="col-6"><label class="form-label small fw-bold">Model</label><input type="text" id="car-model" class="form-control" required></div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-4"><label class="form-label small fw-bold">Year</label><input type="number" id="car-year" class="form-control" placeholder="2023"></div>
                            <div class="col-8"><label class="form-label small fw-bold">Plate No</label><input type="text" id="car-plate" class="form-control" placeholder="ABC 1234"></div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-6"><label class="form-label small fw-bold">Spec</label><input type="text" id="car-spec" class="form-control" placeholder="V-Spec"></div>
                            <div class="col-6"><label class="form-label small fw-bold">Colour</label><input type="text" id="car-colour" class="form-control"></div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-6"><label class="form-label small fw-bold">Body Price</label><input type="number" id="car-price" class="form-control" placeholder="RM" required></div>
                            <div class="col-6"><label class="form-label small fw-bold">Proc. Fee</label><input type="number" id="car-proc-fee" class="form-control" value="2500"></div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-6">
                                <label class="form-label small fw-bold">Branch</label>
                                <select id="car-branch" class="form-select">
                                    <option value="manthong">ManThong</option>
                                    <option value="everforward">EverForward</option>
                                    <option value="tscar">TsCar</option>
                                </select>
                            </div>
                            <div class="col-6">
<label class="form-label small fw-bold">Status</label>
<select id="car-status" class="form-select">
    <option value="ready">‚úÖ Ready Stock</option>
    <option value="preparing">üõ†Ô∏è Preparing</option>
    <option value="booked">üîí Booked</option>
</select>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label small fw-bold">Image URL (HTTPS)</label>
                            <input type="url" id="car-image" class="form-control" placeholder="https://...">
                        </div>

                        <button type="submit" class="btn btn-primary w-100 fw-bold py-2">Save Record</button>
                        <button type="button" onclick="resetForm()" class="btn btn-link w-100 btn-sm mt-1 text-muted">Clear / Reset</button>
                    </form>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="row" id="admin-inventory-list"></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="recycleModal" tabindex="-1">
        <div class="modal-dialog modal-lg border-0">
            <div class="modal-content shadow-lg" style="border-radius: 20px;">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title fw-bold"><i class="bi bi-trash"></i> Recently Deleted</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr><th>Vehicle</th><th>Deleted At</th><th>Actions</th></tr>
                            </thead>
                            <tbody id="recycle-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
    <script>
        dataManager.requireAdmin();

        document.addEventListener('DOMContentLoaded', () => dataManager.renderInventory('admin-inventory-list'));

        document.getElementById('car-form').onsubmit = function(e) {
            e.preventDefault();
            const index = parseInt(document.getElementById('edit-index').value);
            const carData = {
                brand: document.getElementById('car-brand').value,
                model: document.getElementById('car-model').value,
                year: document.getElementById('car-year').value,
                spec: document.getElementById('car-spec').value,
                colour: document.getElementById('car-colour').value,
                plate: document.getElementById('car-plate').value,
                price: document.getElementById('car-price').value,
                proc_fee: document.getElementById('car-proc-fee').value,
                branch: document.getElementById('car-branch').value,
                status: document.getElementById('car-status').value,
                image: document.getElementById('car-image').value
            };

            let cars = dataManager.getCars();
            if(index === -1) cars.push(carData);
            else cars[index] = carData;

            dataManager.saveCars(cars);
            resetForm();
            dataManager.renderInventory('admin-inventory-list');
        };

        function editCar(index) {
            const car = dataManager.getCars()[index];
            document.getElementById('edit-index').value = index;
            document.getElementById('car-brand').value = car.brand;
            document.getElementById('car-model').value = car.model;
            document.getElementById('car-year').value = car.year || '';
            document.getElementById('car-spec').value = car.spec || '';
            document.getElementById('car-colour').value = car.colour || '';
            document.getElementById('car-plate').value = car.plate || '';
            document.getElementById('car-price').value = car.price;
            document.getElementById('car-proc-fee').value = car.proc_fee || 2500;
            document.getElementById('car-branch').value = car.branch;
            document.getElementById('car-status').value = car.status;
            document.getElementById('car-image').value = car.image;
            document.getElementById('form-title').innerText = "Edit Vehicle";
            window.scrollTo(0,0);
        }

        function deleteCar(index) {
            if(confirm('Move to Recycle Bin?')) {
                dataManager.moveToRecycle(index);
                dataManager.renderInventory('admin-inventory-list');
            }
        }

        function openRecycleBin() {
            renderRecycleList();
            new bootstrap.Modal(document.getElementById('recycleModal')).show();
        }

        function renderRecycleList() {
            const list = document.getElementById('recycle-list');
            const deleted = dataManager.getDeletedCars();
            if(deleted.length === 0) { list.innerHTML = '<tr><td colspan="3" class="text-center p-4">Recycle bin is empty</td></tr>'; return; }
            list.innerHTML = deleted.map((car, idx) => `
                <tr>
                    <td><div class="fw-bold small">${car.brand} ${car.model}</div><div class="text-muted small">${car.plate || '-'}</div></td>
                    <td class="small text-muted">${car.deletedAt}</td>
                    <td>
                        <button onclick="dataManager.restoreCar(${idx}); renderRecycleList(); dataManager.renderInventory('admin-inventory-list');" class="btn btn-success btn-sm">Restore</button>
                        <button onclick="if(confirm('Purge?')){dataManager.permanentDelete(${idx}); renderRecycleList();}" class="btn btn-link btn-sm text-danger text-decoration-none">Purge</button>
                    </td>
                </tr>
            `).join('');
        }

        function resetForm() {
            document.getElementById('car-form').reset();
            document.getElementById('edit-index').value = "-1";
            document.getElementById('form-title').innerText = "Add New Vehicle";
        }
    </script>
</body>
</html>